name: Publish RobotFramework DoIP to PyPI

on:
  push:
    branches: 
      - htv3hc/test/feature

jobs:
  build-n-publish:
      name: Build and publish to PyPI
      runs-on: ubuntu-latest

      steps:
        - name: Checkout source
          uses: actions/checkout@v2

        - name: Set up Python
          uses: actions/setup-python@v4.3.0
          with:
            python-version: "3.9"

        - name: Install dependencies
          run: |
            sudo apt-get install -y pandoc
            sudo apt-get install -y texlive-latex-*
            echo "GENDOC_LATEXPATH=$(dirname $(which pdflatex))" >> $GITHUB_ENV
            python -m pip install --upgrade build twine wheel robot GenPackageDoc PythonExtensionsCollection

        - name: Download Linux installer package
          uses: actions/download-artifact@v4
          with:
            name: my-other-artifact
            github-token: ${{ secrets.GH_PAT }} # token with actions:read permissions on target repo
            repository: test-fullautomation/RobotFramework_AIO
            run-id: 8648857135

        - name: Install RobotFramework AIO
          run: |
            ls -la
            sudo apt-get update
            sudo apt-get install ./*.deb --fix-missing

        - name: Build source and wheel distributions
          run: |
            python setup.py sdist bdist_wheel
            twine check --strict dist/*

        # - name: Publish distribution to PyPI
        #   uses: pypa/gh-action-pypi-publish@release/v1
        #   with:
        #     password: ${{ secrets.PYPI_API_TOKEN }} # This token should be created in Settings > Secrets > Actions
        #     # repository_url: https://test.pypi.org/legacy/ # Use this for testing to upload the distribution to test.pypi

        # - name: Create/Update GitHub Release
        #   id: create_update_release
        #   uses: ncipollo/release-action@v1
        #   with:
        #     allowUpdates: true
        #     omitNameDuringUpdate: true
        #     makeLatest: true
        #     artifacts: dist/*